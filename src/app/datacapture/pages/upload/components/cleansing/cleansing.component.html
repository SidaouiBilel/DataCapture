<div class="main-container flex-box">
  <!-- Header -->
  <div class="importHeader" nz-row>
    <div nz-col nzSpan="18">
      <div class="flex start">
        <nz-badge class="mr-3" nz-tooltip nzTooltipTitle="Total errors" [nzOverflowCount]="99999999"
          [nzCount]="(metaData$ | async)?.totalErrors || 0" [nzShowZero]="true"></nz-badge>
        <nz-badge nz-tooltip nzTooltipTitle="Total Rows in Error" [nzOverflowCount]="99999999"
          [nzCount]="(metaData$ | async)?.uniqueErrorLines || 0" [nzShowZero]="true"></nz-badge>
        <nz-divider class="error" nzType="vertical"></nz-divider>
        <button nz-tooltip nzTooltipTitle='Details' nz-popover [nzPopoverContent]="contentTemplate"
          nzPopoverPlacement="bottom" nzShape='round' class="ghost" nzPopoverTrigger="click" nz-button>
          <i nz-icon nzType="exception"></i>
        </button>
        <button nz-tooltip nzTooltipTitle='Save modifications' nzShape='round' class="ghost" nz-button
          (click)="syncWithServer()">
          <i nz-icon nzType="save"></i>
        </button>
        <nz-divider nzType="vertical"></nz-divider>
        <button nz-tooltip nzTooltipTitle='Audit Trial' nzShape='round' class="ghost" nz-button (click)="auditTrial()">
          <i nz-icon nzType="audit"></i>
        </button>
      </div>
    </div>
    <div nz-col nzSpan="6" class="text-right button-spacing">
      <div class="flex end">
        <button nz-button nzType="primary" nzGhost nzSize="middle" nzShape="round" nz-tooltip
          nzTooltipTitle="Previous Step" nzTooltipPlacement="left" (click)="goToMapping()"><i nz-icon
            nzType="caret-left"></i> Previous</button>
        <button nz-button nzType="primary" nzSize="middle" nzShape="round" nz-tooltip nzTooltipTitle="Next Step"
          nzTooltipPlacement="left" (click)="goToUpload()">Next<i nz-icon nzType="caret-right"></i></button>
        <nz-divider nzType='vertical'></nz-divider>
        <button nz-button nzSize="middle" nzShape="circle" nz-tooltip nzTooltipTitle="Reset" nzTooltipPlacement="left"
          (click)="cancelUpload()">
          <i nz-icon nzType="close"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- jobResult -->
  <!-- Grid -->
  <div class="flex flex-1 column start mt-4">
    <app-data-grid class="flex-1" [columnDefs]="headers$ | async" [paginationPageSize]="numberOfRows"
      (cellValueChanged)="editCell($event)" (gridReady)="fetchData($event)">
    </app-data-grid>
    <div class="w-100 flex end">
      <app-shortcuts-list [shortcuts]='(hotkeys.registeredHostkeys$ | async)'></app-shortcuts-list>
    </div>
  </div>
</div>

<ng-template #contentTemplate>
  <div *ngFor="let item of (metaData$ | async)?.jobResult">
    <span class="pr-2"><small>{{ keys(item)[0]}}:</small></span>
    <span class="text-danger">{{ item[keys(item)[0]] }}</span>
  </div>
</ng-template>

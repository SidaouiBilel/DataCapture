<div class="main-container flex-box">
  <!-- Header -->
  <div class="importHeader" nz-row>
    <div nz-col nzSpan="18">
      <!-- <nz-select [class.requiredInput]="!selectedDomain" [(ngModel)]="selectedDomain" class="selectStyleSheet" (ngModelChange)="selectDomain($event)">
        <nz-option *ngFor="let domain of domains; let i = index" [nzValue]="domain.id" [nzLabel]="domain.name"></nz-option>
      </nz-select> -->
      <button nz-button class="w-50" nz-dropdown [nzDropdownMenu]="menu" [nzPlacement]="'bottomRight'">{{ selectedDomain?.name }}</button>
    </div>
    <div nz-col nzSpan="6" class="text-right button-spacing">
      <button nz-button nzType="primary" nzSize="middle" nzShape="round" nz-tooltip nzTooltipTitle="Next Step"
          nzTooltipPlacement="left" (click)="goToPreview()">Next<i nz-icon nzType="caret-right"></i></button>
        <nz-divider nzType='vertical'></nz-divider>
        <button nz-button nzSize="middle" nzShape="circle" nz-tooltip nzTooltipTitle="Reset" nzTooltipPlacement="left"
          (click)="cancelUpload()">
          <i nz-icon nzType="close"></i>
        </button>
    </div>
  </div>

  <nz-divider class="horiz" [nzText]="(importState$ | async)?.selectedFile?.token" nzOrientation="left"></nz-divider>

  <!-- If The file isn't uploaded -->
  <div class="flex-child" *ngIf="!(importState$ | async)?.error && !(importState$ | async)?.imported">
    <nz-spin class="flex-box" [nzSpinning]="(importState$ | async)?.importing">
      <nz-upload nzType="drag" [nzAction]="url" [nzShowUploadList]="false"
        [nzAccept]="'.csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel'"
        (nzChange)="handleChange($event)">
        <p class="ant-upload-drag-icon">
          <i nz-icon nzType="inbox"></i>
        </p>
        <p class="ant-upload-text">Click or drag file to this area to import</p>
        <p class="ant-upload-hint">
          Once selected the file will be automatically uploaded into our server.
        </p>
      </nz-upload>
    </nz-spin>
  </div>

  <!-- If the file was uploaded successfully -->
  <div class="flex-child centerBox" *ngIf="(importState$ | async)?.imported">
    <nz-result nzStatus="success" nzTitle="Your file has been uploaded successfully."
      nzSubTitle="You may proceed to the next step.">
      <div nz-result-extra>
        <button nz-button nzType="primary" (click)="goToPreview()">Next</button>
        <button nz-button nzType="danger" (click)="cancelUpload()">Cancel</button>
      </div>
    </nz-result>
  </div>

  <!-- If the file was not uploaded -->
  <div class="flex-child centerBox" *ngIf="(importState$ | async)?.error">
    <div class="flex-child" *ngIf="(importState$ | async)?.error">
      <nz-result nzStatus="error" nzTitle="An error occured when attempting to upload the file."
        nzSubTitle="Please try again or contact us.">
        <div nz-result-extra>
          <button nz-button nzType="danger" (click)="cancelUpload()">Cancel</button>
        </div>
      </nz-result>
    </div>
  </div>
</div>

<nz-dropdown-menu #menu="nzDropdownMenu">
  <ul nz-menu>
    <li *ngFor="let item of keys(domains)" nz-submenu [nzTitle]="item">
      <ul>
        <li *ngFor="let domain of domains[item]" nz-menu-item (click)="selectDomain(domain.identifier, domain.name)">{{domain.name}}</li>
      </ul>
    </li>
  </ul>
</nz-dropdown-menu>

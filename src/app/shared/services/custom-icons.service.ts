import { DOCUMENT } from '@angular/common';
import { HttpBackend } from '@angular/common/http';
import { Inject, Injectable, RendererFactory2 } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { NzIconService } from 'ng-zorro-antd/icon';
import { NzConfigService } from 'ng-zorro-antd/core/config';
import { map, take, tap } from 'rxjs/operators';

const SaveAsOutline = {
  name: 'saveAs-o',
  icon: `<svg viewBox="0 0 520 520"><path style='fill-rule: evenodd;' d="M447.09,458.911V416.273h15.555V150.756l-21.388-20.35-3.889-4.845h-1.945L399.452,88.737,367.369,57.728H100.983V74.2H58.205V44.161q0.486-7.752.972-15.5H60.15l0.972-3.876,1.944-.969V21.874h0.972l1.945-2.907c7.007-4.975,18.037-4.845,30.138-4.845h254.72l24.305,0.969C394.8,21.021,404.282,33.471,416.951,46.1l37.917,36.824,17.5,18.412,2.916,0.969,8.75,9.69c7.564,7.539,16.458,14.1,20.417,25.195,2.833,7.944.972,29.3,0.972,39.731V392.047c0,20.017,2.577,44.366-5.834,56.2l-1.944.969q-1.458,1.938-2.917,3.876h-1.944l-0.972,1.939h-1.945V456h-1.944v0.969h-2.917v0.969H482.09v0.969h-35ZM26.122,82.923H328.48l0.972,1.938H331.4V85.83h1.944V86.8h1.945v0.969h1.944l0.972,1.938h1.945l18.472,19.381,10.694,9.69,39.861,40.7c9.349,9.319,23.608,19.423,28.194,32.948,2.6,7.659.972,19.827,0.972,29.071V491.858c-0.691,2.151-2.332,4.077-2.917,6.783-2.606,1.507-4.877,4.659-7.777,5.815-6.923,2.757-19.552.969-28.194,0.969H43.622c-12.691,0-24.594.069-27.222-9.691-3.822-3.9-1.944-17.952-1.944-25.195V95.521c0.51-1.574,4.734-8.924,5.833-9.69h1.944V84.861C24.2,83.738,24.416,84.86,26.122,82.923Zm27.222,38.762V466.663H399.452V204.053L328.48,134.282V196.3h-0.972v2.907h-0.972v1.938h-0.972c-1.862,3.229-2.778,5.741-6.806,6.783-2.357,2.315-6.942,1.933-11.666,1.938H146.677c-3.444,0-8.8.676-10.695-.969-12.646-2.7-11.666-14.843-11.666-30.04V121.685H53.344Zm105.971,0v53.3H293.481v-53.3H159.315Zm60.277,134.7c13.119-.168,23.077,1.239,32.083,4.845h2.917V262.2l5.833,1.939V265.1l5.834,1.938v0.969l2.916,0.969,0.972,1.938h1.945l1.944,2.907h1.945l6.805,7.752,2.917,1.938v1.938l2.916,1.939v1.938l1.945,0.969v1.938l1.944,0.969v1.938h0.973v1.938h0.972v1.938h0.972v1.938H296.4l0.972,3.876h0.973v2.907c5.959,14.984,6.029,35.407,0,50.39v2.908h-0.973q-0.972,2.906-1.944,5.814h-0.972v1.938h-0.972q-0.486,1.938-.973,3.876l-1.944.969v1.938l-1.945.969v1.938l-2.916,1.938v1.938l-6.806,5.815-2.916,3.876h-1.945l-1.944,2.907h-1.945l-0.972,1.938h-1.944l-0.972,1.938h-1.945V399.8H262.37v0.969h-1.945v0.969h-1.944v0.969l-3.889.969v0.969h-2.917v0.969h-2.916v0.97H244.87v0.969h-4.861v0.969H233.2v0.969H219.592v-0.969h-7.777v-0.969h-3.889v-0.969h-3.889v-0.97H201.12v-0.969H198.2v-0.969h-1.945v-0.969h-2.916v-0.969H191.4v-0.969h-1.944l-0.972-1.938-3.889-.969-0.972-1.938h-1.945l-1.944-2.907h-1.945l-3.889-4.845-7.777-6.784v-1.938l-2.917-1.938v-1.938l-1.944-.969v-1.938l-1.945-.969-1.944-5.814H156.4v-1.938h-0.973v-2.907h-0.972V358.13h-0.972v-2.907H152.51v-2.907h-0.972v-4.845c-1.26-4.156-3.8-16.792-1.945-23.257h0.972V318.4h0.973v-4.845h0.972v-2.907h0.972V307.74h0.972v-2.907h0.972v-2.907H156.4v-1.938h0.972l1.944-5.814,1.945-.969v-1.938l1.944-.969V288.36l2.917-1.939v-1.938L173.9,277.7l3.889-4.845h1.945l1.944-2.907h1.945l0.972-1.938,3.889-.969,0.972-1.938H191.4v-0.969h1.945v-0.969l18.472-5.815h7.777v-0.969Zm0.973,34.886c-1.931,1.662-5.18.912-7.778,1.938v0.969H209.87v0.969l-5.833,1.938-1.944,2.907h-1.945l-4.861,5.814-2.916,1.938v1.938l-1.945.97q-0.972,2.905-1.944,5.814h-0.973v2.907h-0.972v2.907h-0.972v3.876c-2.961,9.419.59,19.012,3.889,25.195l0.972,3.876,1.945,0.969v1.938l4.861,3.877,2.916,3.876h1.945l0.972,1.938h1.944l0.972,1.938h1.945v0.969h1.944V371.7h2.917c3.614,1.423,12.952,4.814,19.444,2.907l14.583-4.845,0.973-1.938h1.944l1.944-2.907h1.945l0.972-1.938,3.889-2.907V358.13l2.917-1.938,0.972-3.876,1.944-.969q0.972-4.361,1.945-8.721h0.972L268.2,328.09h-0.972l-0.972-8.721h-0.973v-1.938h-0.972v-2.907l-1.944-.969-0.972-3.877q-1.46-.967-2.917-1.938V305.8l-1.945-.969-3.888-4.845H250.7l-0.972-1.938h-1.944l-0.973-1.938-3.888-.969v-0.969l-5.834-.969v-0.969Z"/></svg>`
};
const AutoSaveOutline = {
  name: 'auto-save-o',
  icon: `
  <svg viewBox="0 0 520 520">
    <path class="cls-1" d="M365.907,39.08v1.7c8.849,0.942,13.686,7.758,18.665,12.745q15.7,15.718,31.391,31.437l10.181,9.346,31.392,32.287c7.569,7.58,16.641,14.1,21.21,24.639,2.212,5.1,1.7,13.186,1.7,20.392V435.013c0,9.629,2.019,31.341-1.7,37.384-6.253,10.172-16.421,8.5-32.24,8.5H74.05c-10.741,0-22.617,1.056-28.846-3.4v-0.849l-2.545-1.7v-1.7l-1.7-.85c-2.8-4.555-1.7-14.191-1.7-21.241V70.516c0-7.423-1.276-18.1,1.7-22.94l1.7-.85v-1.7h0.848l1.7-2.549c5.977-4.269,16.786-3.4,27.149-3.4H365.907ZM79.989,79.863V440.111h359.73V165.676L365.907,92.607v66.272c-1.085,1.061-2.174,4.135-2.546,5.948l-4.242,3.4v0.85h-1.7q-0.423.849-.848,1.7l-5.939.85v0.85H206.4c-16.878,0-46.566,3.632-50.057-9.347-3.972-3.542-2.545-14.772-2.545-22.09V79.863H79.989Zm109.446,0v56.076H330.273V79.863H189.435Zm56,131.695H272.58v0.85h5.091v0.849l6.787,0.85v0.85H287v0.849h2.545v0.85h2.545v0.85h2.545v0.849h1.7v0.85h2.545v0.85l3.394,0.849v0.85l3.394,0.849,0.848,1.7,3.394,0.849q0.425,0.85.848,1.7c3.078,2.079,6.566,2.656,7.636,6.8,1.979,1.987,1.1,2.979.849,5.947-1.882,1.239-1.245,1.973-2.546,3.4l-10.181,9.346-3.393,4.248c-1.392.91-4.755,1.5-6.788,1.7v-0.849h-2.545v-0.85l-2.545-.849-0.849-1.7L287,253.19v-0.85l-5.091-1.7v-0.85h-2.545v-0.85h-2.545c-11.814-4.6-25.328-3.638-36.482.85H237.8v0.85l-5.09,1.7v0.85l-3.394.849v0.85l-2.545.85-0.849,1.7h-1.7l-5.091,5.947-5.09,4.249v1.7l-2.546,1.7c-2.321,3.5-4.3,8.678-5.939,12.745,6-.124,11.4.1,15.272,1.7,0.928,1.766,1.367,1.5,1.7,4.248h0.848q-0.848,2.549-1.7,5.1l-1.7.85v1.7l-1.7.85v1.7q-0.849.424-1.7,0.85v1.7l-1.7.849v1.7l-1.7.849q-0.425,1.275-.848,2.549h-0.849q-0.424,1.7-.848,3.4l-1.7.85v1.7l-1.7.849v1.7H206.4l-0.849,2.549-1.7.849v1.7l-1.7.849v1.7h-0.849q-0.424,1.273-.848,2.548l-1.7.85v1.7l-2.545,1.7v1.7q-0.849.425-1.7,0.85v1.7h-0.849q-1.272,1.7-2.545,3.4h-2.545v0.85c-1.7-.487-0.734.1-1.7-0.85-5.906-.835-6.64-6.149-9.333-10.195l-1.7-.85v-1.7h-0.849q-0.424-1.275-.848-2.549l-1.7-.85v-1.7h-0.848l-0.849-2.549-1.7-.85v-1.7l-1.7-.85v-1.7l-1.7-.849v-1.7l-1.7-.849v-1.7l-1.7-.849v-1.7l-1.7-.849v-1.7c-3-4.508-7.232-7.167-7.636-14.443H153.8v-2.549c0.513-1.086.385,0.258,0.848-.85,1.148-.444,1.926-0.316,3.394-0.85v-0.849c3.714-1.2,8.995.22,11.878-.85,0.279-5.665,3.016-11.335,5.09-15.293v-1.7h0.849v-1.7h0.848v-1.7h0.848v-1.7h0.849v-1.7h0.848v-1.7H180.1v-1.7q0.847-.426,1.7-0.85v-1.7l1.7-.85v-1.7l2.546-1.7v-1.7l3.393-2.549v-1.7l6.788-5.948,3.393-4.248h1.7l2.545-3.4h1.7l0.849-1.7,2.545-.849V226h1.7q0.425-.849.848-1.7l3.394-.85q0.424-.849.848-1.7h1.7V220.9l3.394-.849V219.2h2.545v-0.85h1.7v-0.849h2.545v-0.85h1.7v-0.85l5.939-.849v-0.85H237.8v-0.85C240.471,212.316,243.551,213.23,245.431,211.557ZM349.787,325.409c-0.216,6.013-3.183,10.98-5.091,15.294v2.549h-0.848v1.7H343v1.7h-0.848l-0.849,3.4-1.7.849-0.849,3.4-1.7.85v1.7l-2.545,1.7v1.7l-2.545,1.7v1.7l-6.788,5.948-6.787,7.646h-1.7q-0.847,1.275-1.7,2.549l-2.545.85q-0.425.849-.848,1.7l-3.394.85q-0.425.849-.848,1.7l-3.394.85q-0.424.849-.848,1.7h-1.7v0.85h-1.7v0.849h-2.545v0.85l-3.394.85v0.849h-2.545v0.85H288.7v0.85h-2.545v0.849l-5.939.85v0.85c-5.351,1.781-31.134,1.639-36.482,0h-4.242c-14.965-5.109-28.735-10.679-39.027-20.392-2.275-2.146-10.519-6.925-7.636-11.045,0.5-4.184,2.842-4.543,5.091-6.8,4.383-4.4,9.4-12.862,16.968-13.6v0.85l4.242,0.85q0.425,0.849.848,1.7h1.7q1.273,1.7,2.546,3.4l2.545,0.85q0.425,0.849.848,1.7l3.394,0.85q0.424,0.849.848,1.7h1.7v0.85h1.7v0.85H237.8v0.849h1.7v0.85h2.545v0.85h2.546v0.849h2.545v0.85l17.817,0.849v-0.849h7.635v-0.85h3.394v-0.849h2.545c17.037-7.311,28.086-17.949,35.634-34.836h-1.7V324.56H301.427s-0.161-.59-1.7-0.85c-1.344-2.335-2.1-1.527-2.545-5.1h-0.849q0.849-2.549,1.7-5.1l1.7-.849v-1.7l1.7-.849v-1.7l1.7-.849v-1.7l1.7-.849v-1.7h0.849q0.425-1.274.848-2.548l1.7-.85v-1.7l1.7-.85v-1.7l1.7-.85v-1.7l1.7-.85v-1.7l1.7-.85v-1.7l1.7-.85v-1.7q0.849-.425,1.7-0.85v-1.7h0.849q0.423-1.274.848-2.549l1.7-.849v-1.7l1.7-.849c2.833-4.172,2.621-7.106,9.332-7.647v0.849l4.242,0.85q2.121,3.824,4.242,7.647,0.849,0.425,1.7.85v1.7l1.7,0.849v1.7l1.7,0.849v1.7l1.7,0.849v1.7l1.7,0.849v1.7l1.7,0.85v1.7l1.7,0.85v1.7h0.849q0.425,1.275.848,2.549l1.7,0.85v1.7l1.7,0.85v1.7l1.7,0.85v1.7l1.7,0.85v1.7l1.7,0.85a17.646,17.646,0,0,1,3.394,10.195h-0.848v1.7l-1.7.849v0.85Z"/>
  </svg>`
};

@Injectable({
  providedIn:'root'
})
export class CustomIconsService extends NzIconService{

  constructor(rendererFactory: RendererFactory2, sanitizer: DomSanitizer, nzConfigService: NzConfigService, handler: HttpBackend, @Inject(DOCUMENT) _document: Document) { 
    const icons = [SaveAsOutline, AutoSaveOutline]
    super(rendererFactory,sanitizer,nzConfigService,handler,_document , icons)
  }

  getIconSvgElement(type){
    var img = document.createElement('img');
    this._loadIconDynamically(type).subscribe(e=>{
      img.innerHTML = e.icon.trim();
      const svgElm = img.firstChild as HTMLElement
      try{

        svgElm.setAttribute('height', '64')
        svgElm.setAttribute('width', '64')
        svgElm.setAttribute("xmlns","http://www.w3.org/2000/svg")
        svgElm.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink")
        // svgElm.setAttribute("viewBox","0 0 64, 64" )
        svgElm.setAttribute("fill","#fff")
      } catch(exp){
        console.log('ERROR ON ', type, svgElm, e.icon, e)
      }
      // svgElm.setAttribute("fill-rule","evenodd")
      
      const source = `data:image/svg+xml;base64,${btoa(svgElm.outerHTML)}`
      img.setAttribute('src', source)
    })
    return img
  }

  
}
